# 찾아주세종 (AI 기반 분실물 관리 시스템) — Backend

교내에 흩어져 관리되던 분실물을 한 곳에서 **등록 → 매칭 → 알림 → 수령 인증**까지 처리할 수 있도록 만든 웹 서비스입니다.  
분실물 이미지를 기반으로 AI가 유사한 후보를 추천하고, SSE 실시간 알림과 QR 기반 수령 인증으로 사용자 경험과 신뢰성을 함께 높였습니다.

> 🎯 목표: **“찾는 사람은 빠르게, 관리자는 효율적으로”**  
> 분실물 반환 과정의 병목(탐색/확인/연락/수령)을 시스템으로 줄이는 데 집중했습니다.

---

## 주요 기능

### 1) AI 이미지 매칭 기반 분실물 추천
- 사용자가 분실물(습득/분실)을 등록하면 이미지 업로드 후 AI 서버에 매칭 요청
- AI가 유사 후보를 반환하면 매칭 결과를 저장하고 사용자에게 알림

### 2) 실시간 알림 (SSE)
- 매칭 결과/상태 변경 시 **SSE(Server-Sent Events)** 로 사용자에게 즉시 알림
- 재연결 및 이벤트 유실을 고려해 `lastEventId` 기반 재전송 구조를 적용

### 3) 분실물 검색
- 복합 조건(카테고리/장소/시간/키워드 등) 기반 검색 지원

### 4) 수령 인증 (QR)
- 수령 시 QR 코드 인증으로 본인 확인
- 수령 상태 변경을 통해 오남용/오인 수령을 방지

### 5) 이미지 파일 관리 (AWS S3)
- 이미지 업로드/조회/보관을 확장성 있게 처리

---

## 기술 스택

- Backend: Java, Spring Boot, Spring Data JPA
- Database: MySQL
- Realtime: SSE(Server-Sent Events)
- Storage: AWS S3
- Etc.: Git/GitHub, Notion

---

## 시스템 아키텍처 (요약)

1. 사용자가 분실물(습득/분실) 등록
2. 이미지 업로드 → S3 저장 → 메타데이터 DB 반영
3. AI 서버에 이미지 매칭 요청 → 후보 결과 수신
4. 매칭 결과/상태 변경 이벤트 발생
5. 이벤트 리스너가 비동기로 SSE 구독 클라이언트에 알림 전송
6. 수령 시 QR 인증으로 본인 확인 후 상태 변경

> ⚙️ “실시간성 + 안정성”을 위해 알림 로직을 비동기로 분리했고,  
> 트랜잭션 경계 및 Lazy Loading 예외 등을 고려해 데이터 전달 구조를 정리했습니다.

---

## DB 모델 (ERD)

- ERD 이미지: `/docs/erd.png`

### 핵심 도메인
- User
- Item
- Matching (AI 매칭 결과)
- Notify (알림)
- Comment
- QR (수령 인증)

---

## 설계 고민 & 트러블슈팅 (진행 중)

### 1. 비동기 이벤트 처리와 트랜잭션 경계

**문제 인지**
- 분실물 등록 이후 AI 매칭 요청 및 실시간 알림을 이벤트 기반 비동기 구조로 분리하면서,
  이벤트 리스너가 트랜잭션 커밋 이전의 데이터를 조회할 수 있는 구조적 가능성을 인지했다.

**고민 포인트**
- 알림과 외부 AI 서버 요청은 응답 지연을 줄이기 위해 비동기로 처리하고 싶었지만,
  데이터 정합성이 보장되지 않으면 잘못된 매칭/알림이 전달될 수 있었다.

**개선 방향**
- 트랜잭션 커밋 이후에만 이벤트 리스너가 실행되도록 구조를 보완할 계획이며,
  비동기 처리 시점과 트랜잭션 경계에 대한 이해를 바탕으로 설계를 개선 중이다.

---

### 2. QR 수령 인증 중복 처리 가능성

**문제 인지**
- QR 코드 인증 요청이 동시에 들어올 경우,
  동일한 분실물이 중복으로 수령 처리될 수 있는 가능성이 존재함을 확인했다.

**고민 포인트**
- 수령 인증은 기능 구현보다 **오남용 방지와 정합성 보장**이 더 중요하다고 판단했다.

**개선 방향**
- 수령 인증 로직에 트랜잭션과 동시성 제어를 적용하여,
  한 번의 요청만 유효하도록 보장하는 구조로 개선할 계획이다.
